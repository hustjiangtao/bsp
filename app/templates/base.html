<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}{{ title }}{% endblock %} - BSP</title>

    <meta name="keywords" content="bsp Google Bookmark" />
    <meta name="description" content="Google Bookmark share plan" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="author" content="jiangtao, jiangtao.work@gmail.com" />

    <script src="{{ url_for('static', filename='js/moment.min.js') }}"></script>
</head>
<body>
<div>
    BSP:
    <a href="{{ url_for('main.index') }}">Home</a>
    <a href="{{ url_for('main.explore') }}">Explore</a>
    {% if current_user.is_authenticated %}
        <a href="{{ url_for('main.user', username=current_user.username) }}">Profile</a>
        <form style="display: inline;" action="{{ url_for('main.search') }}" method="get">
            {{ g.search_form.q(size=20, placeholder=g.search_form.q.label.text) }}
            <input type="submit" value="Search">
        </form>
        <a href="{{ url_for('main.messages') }}">Messages
            {% set new_messages = current_user.new_messages() %}
            {% if new_messages %}<span>{{ new_messages }}</span>{% endif %}
        </a>
        <a href="{{ url_for('auth.logout') }}">Logout</a>
    {% else %}
        <a href="{{ url_for('auth.login') }}">Login</a>
    {% endif %}
</div>
<hr>
{% with messages = get_flashed_messages() %}
    {% if messages %}
        <ul>
            {% for message in messages %}
                <li>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}
{% endwith %}
{% block content %}{% endblock %}
</body>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
{% block scripts %}
    <script>
        // pull notification count & update
        {% if current_user.is_authenticated %}
            $(function() {
                let since = 0;
                setInterval(function() {
                    $.ajax('{{ url_for('main.notifications') }}?since=' + since).done(
                        function(notifications) {
                            for (let i = 0; i < notifications.length; i++) {
                                if (notifications[i].name == 'unread_message_count')
                                    set_message_count(notifications[i].data);
                                since = notifications[i].timestamp;
                            }
                        }
                    );
                }, 10000);
            });
        {% endif %}
    </script>
{% endblock %}
</html>